<template>

  <style type="text/css">
    :host {
      display: inline-block;
    }
    /* module
        ========================================================================== */
    .me {
      font-family: "Helvetica", Arial, sans-serif;
      display: inline-block;
      width: 265px;
      height: 300px;
      overflow: hidden;
      border-radius: 6px;
      position: relative;
      background-color: #2E353C;
      text-align: center;
      color: #fff;
      font-weight: 100;
      transition: background 1000ms ease-out;
    }
    .me dt {
      display: none;
    }
    .me dd,
    .me dl {
      margin: 0;
    }
    .me-profile {
      background: #fff;
      height: 85px;
      border: 1px solid #D5D5D5;
      border-bottom: 0;
    }
    dd.me-image {
      display: inline-block;
      margin: 20px 0 10px;
    }
    .me-image img {
      height: 120px;
      width: 120px;
      border-radius: 100%;
      border: 3px solid #D5D5D5;
      vertical-align: middle;
      background: #fff;
    }
    .me-name {
      font-size: 24px;
    }
    .me-contact {
      position: relative;
      top: 19px;
      padding: 10px;
      border-top: 1px solid #999;
      color: #999;
    }
    a.me-contact-url {
      text-decoration: none;
    }
    /* thema
        ========================================================================== */
    .enpura {
      background-color: #1d2654;
      color: #eef1fd;
    }
    .enpura .me-profile {
      background: #fff;
      border: 1px solid #d8dbe7;
    }
    .enpura .me-title,
    .enpura .me-company,
    .enpura .me-contact {
      color: #7782bf;
    }
    .enpura .me-contact {
      border-top: 1px solid #7782bf;
    }
    .enpura .me-image img {
      border: 3px solid #d8dbe7;
    }
    /* animation
        ========================================================================== */
    .animation {
      -webkit-animation-duration: 1s;
      animation-duration: 1s;
      -webkit-animation-fill-mode: both;
      animation-fill-mode: both;
    }
    .hinge {
      -webkit-animation-name: hinge;
      animation-name: hinge;
    }
    @keyframes hinge {
      0% {
        left: 0px;
        top: 0px;
        opacity: 1;
        transform: rotate(0deg) scaleX(1) scaleY(1);
      }
      20% {
        transform: rotate(60deg);
      }
      40% {
        transform: rotate(40deg);
      }
      60% {
        transform: rotate(54deg);
      }
      80% {
        transform: rotate(42deg);
      }
      100% {
        left: 0px;
        top: 0px;
        opacity: 1;
        transform: rotate(46deg) scaleX(1) scaleY(1);
      }
    }
    @-webkit-keyframes hinge {
      0% {
        left: 0px;
        top: 0px;
        opacity: 1;
        -webkit-transform: rotate(0deg) scaleX(1) scaleY(1);
      }
      20% {
        -webkit-transform: rotate(60deg);
      }
      40% {
        -webkit-transform: rotate(40deg);
      }
      60% {
        -webkit-transform: rotate(54deg);
      }
      80% {
        -webkit-transform: rotate(42deg);
      }
      100% {
        left: 0px;
        top: 0px;
        opacity: 1;
        -webkit-transform: rotate(46deg) scaleX(1) scaleY(1);
      }
    }
  </style>

  <article class="me animation">
    <dl class="me-profile">
      <dt>画像</dt>
      <dd class="me-image">
        <img src=""></img>
      </dd>

      <dt>所属</dt>
      <dd class="me-company"></dd>

      <dt>名前</dt>
      <dd class="me-name"></dd>

      <dt>肩書き</dt>
      <dd class="me-title"></dd>

      <dt>アカウント</dt>
      <a href="" class="me-contact-url">
        <dd class="me-contact"></dd>
      </a>
    </dl>

  </article>
</template>

<script>
  // Creates an object based in the HTML Element prototype
  var elementProto = Object.create(HTMLElement.prototype);

  // Web Componets側のdocument
  var doc = document.currentScript.ownerDocument;
  
  // <template>タグ
  var template = doc.querySelector('template').content;

  // 個人情報
  var me = {
    img: "https://avatars1.githubusercontent.com/u/4105415",
    name: "えんぷら部",
    company: "html5jエンタープライズ部",
    title: "オープンコミュニティ",
    contact: "#html5biz",
    contactUrl: "http://www.html5biz.org/"
  };

  // elementが作成された時に発火
  elementProto.createdCallback = function() {

    // CustomElementをshadowDom化
    var shdowDom = template.cloneNode(true);
    var shadowRoot = this.createShadowRoot();
    shadowRoot.appendChild(shdowDom);
        
    var me = shadowRoot.querySelector('.me');
    
    var thema = this.getAttribute('thema');
    if (thema) me.classList.add(thema);
    
    var animation = this.getAttribute('animation');
    
    this.addEventListener('click', function(e) {
      if (animation) {
        me.classList.add(animation);
        setTimeout(function() {
          me.classList.remove(animation);
        }, 2000);
      }
    });
  };

  // elementがdocumentに追加された時に発火
  elementProto.attachedCallback = function() {
    this.fillMe();
  };

  // elementがdocumentから削除された時に発火
  elementProto.detachedCallback = function() {};

  // attributeが追加、削除、変更された時に発火
  elementProto.attributeChangedCallback = function(attr, oldVal, newVal) {};

  // 名刺に個人情報を設定する
  elementProto.fillMe = function() {

    var card = this.shadowRoot;
    card.querySelector('.me-image img').src = me.img;
    card.querySelector('.me-name').textContent = me.name;
    card.querySelector('.me-company').textContent = me.company;
    card.querySelector('.me-title').textContent = me.title;
    card.querySelector('.me-contact').textContent = me.contact;
    card.querySelector('.me-contact-url').href = me.contactUrl;

  };
  
  // カスタム要素を登録
  document.registerElement('x-business-card', {
    prototype: elementProto
  });
  
</script>